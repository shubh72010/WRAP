<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced Image Editor</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 0; padding: 0; background: #111; color: white; }
    canvas { border: 2px solid #888; margin: 20px 0; }
    input[type="file"] { margin-top: 20px; }
    .controls { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding: 10px; }
    button, select, input[type="range"] { padding: 8px; border-radius: 5px; border: none; cursor: pointer; background: #333; color: white; }
    button:hover { background: #444; }
  </style>
</head>
<body>
  <h1>Advanced Image Editor</h1>
  <input type="file" id="upload" />
  <div class="controls">
    <button onclick="rotate(-90)">Rotate Left</button>
    <button onclick="rotate(90)">Rotate Right</button>
    <button onclick="flipX()">Flip Horizontal</button>
    <button onclick="flipY()">Flip Vertical</button>
    <button onclick="resetImage()">Reset</button>
    <button onclick="downloadImage()">Download</button>
    <input type="range" min="-100" max="100" value="0" id="brightness" onchange="adjust()">Brightness</input>
    <input type="range" min="-100" max="100" value="0" id="contrast" onchange="adjust()">Contrast</input>
    <input type="text" id="textInput" placeholder="Add text">
    <button onclick="addText()">Insert Text</button>
    <select id="filterSelect" onchange="applyFilter(this.value)">
      <option value="none">None</option>
      <option value="grayscale(100%)">Grayscale</option>
      <option value="sepia(100%)">Sepia</option>
      <option value="invert(100%)">Invert</option>
      <option value="blur(2px)">Blur</option>
      <option value="brightness(150%)">Brighten</option>
    </select>
  </div>
  <canvas id="canvas" width="600" height="400"></canvas>  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let img = new Image();
    let angle = 0, flipH = 1, flipV = 1, originalImg;

    document.getElementById("upload").addEventListener("change", e => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          img.onload = () => {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            originalImg = ctx.getImageData(0, 0, canvas.width, canvas.height);
          };
          img.src = evt.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    function redraw() {
      ctx.save();
      ctx.setTransform(flipH, 0, 0, flipV, canvas.width / 2, canvas.height / 2);
      ctx.clearRect(-canvas.width / 2, -canvas.height / 2, canvas.width, canvas.height);
      ctx.translate(-canvas.width / 2, -canvas.height / 2);
      ctx.rotate(angle * Math.PI / 180);
      ctx.drawImage(img, 0, 0);
      ctx.restore();
    }

    function rotate(deg) {
      angle = (angle + deg) % 360;
      redraw();
    }

    function flipX() {
      flipH *= -1;
      redraw();
    }

    function flipY() {
      flipV *= -1;
      redraw();
    }

    function adjust() {
      if (!originalImg) return;
      const brightness = parseInt(document.getElementById("brightness").value);
      const contrast = parseInt(document.getElementById("contrast").value);
      let imageData = new ImageData(new Uint8ClampedArray(originalImg.data), originalImg.width, originalImg.height);
      for (let i = 0; i < imageData.data.length; i += 4) {
        for (let j = 0; j < 3; j++) {
          imageData.data[i + j] = truncate((imageData.data[i + j] - 128) * (contrast / 100 + 1) + 128 + brightness);
        }
      }
      ctx.putImageData(imageData, 0, 0);
    }

    function truncate(value) {
      return Math.max(0, Math.min(255, value));
    }

    function resetImage() {
      if (!originalImg) return;
      angle = 0; flipH = 1; flipV = 1;
      ctx.putImageData(originalImg, 0, 0);
    }

    function addText() {
      const text = document.getElementById("textInput").value;
      if (text) {
        ctx.font = "32px sans-serif";
        ctx.fillStyle = "white";
        ctx.fillText(text, 50, 50);
      }
    }

    function applyFilter(filterValue) {
      canvas.style.filter = filterValue;
    }

    function downloadImage() {
      const link = document.createElement("a");
      link.download = "edited-image.png";
      link.href = canvas.toDataURL();
      link.click();
    }
  </script></body>
</html>